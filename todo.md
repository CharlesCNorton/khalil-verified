# Khalil-Verified: Outstanding Issues

1. Add Ltac automation for exhaustive case splits on `foot`, `meter`, `zihaf`, `ʿilla`, and `compound_zihaf` types. The current 8-way foot destructs and 16-way meter destructs are done manually every time; a `decide_by_exhaustion` tactic or similar would eliminate hundreds of repetitive proof lines. Force multiplier for items 3, 4, 6.
2. Strengthen witnesses and counterexamples so that each one tests a property the universal lemma does NOT already guarantee — e.g., boundary cases, off-by-one positions, interaction between operations, or coverage of all constructors. Beyond strengthening, aggressively cull the trivial ones: the file currently has ~2000+ lines of `Example` blocks proved by `reflexivity` that add no proof-theoretic value (e.g., `weight_eq_dec Short Short = left eq_refl`, `NoDup [Faulun; Faulun]` failing). Item 1 addresses quality; this addresses quantity — at least half should be deleted outright.
3. Generalize mutaḥarrik-modifying lemmas (`iḍmār_preserves_morae`, `shamm_preserves_morae`, `ʿaṣb_preserves_morae`, `waqṣ_reduces_morae`, `ʿaql_reduces_morae`, and corresponding count lemmas) to pattern-general lemmas analogous to `delete_sakin_preserves_count`, eliminating the per-foot `destruct f` proofs.
4. Prove correctness of compound zihāf simultaneous deletion. `apply_khabl` uses `delete_at 1 (delete_at 3 ls)` (simultaneous) while `apply_khazl` uses sequential composition (iḍmār then tayy). There is no theorem proving that the simultaneous approach for khabl/shakl is equivalent to sequential application of their component operations (or, if it isn't equivalent, documenting why the simultaneous version is the correct one). This is a proof obligation about the internal consistency of the variation model.
5. Generalize `rotate_add_mod` to arbitrary naturals. The current preconditions (`n ≤ length p`, `m ≤ length p`) don't cover arbitrary rotation amounts, and the proof manually handles `n + m = 2 * length p` as a special case without handling larger sums. A proper version should state the theorem for all `n, m : nat` by reducing mod `length p` first, or at minimum document that the restricted version suffices for the circle-rotation application.
6. Add meter-specific ḥashw refinements to `foot_permitted_zihaf` — e.g., kaff on mafāʿīlun is rare/ugly in Ṭawīl but acceptable in other meters. Currently the rules are per-foot-type only, with no meter-level overrides.
7. Formalize poem sub-genres (ghazal, rubāʿī, maqṭūʿa) as structural predicates over the `poem` type.
8. Introduce a `SuperLong` weight constructor to distinguish tarfīl from tadhyīl at the type level. Currently `tarfīl_eq_tadhyīl` proves them extensionally identical, meaning the formalization conflates two traditionally distinct operations. This propagates changes throughout the weight type and all downstream definitions. Do last — touches everything.
9. Add `Extraction` directives for the core computable functions (`scan`, `pattern_to_meter`, `apply_khabn`, etc.) to OCaml or Haskell, enabling use outside Coq.
10. Build an extracted test harness that runs the scanner against known syllable-weight transcriptions of classical Arabic verses (e.g., the opening of the Muʿallaqa of Imruʾ al-Qays in Ṭawīl). **This is the single most important validation step.**
